
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Scaled City Application</title>


    <script type="text/javascript" src="js/jquery-1.3.2-vsdoc2.js"></script>

    <link href="css/bootstrap.min.css" rel="stylesheet">

    <link href="css/main.css" rel="stylesheet">
    <link rel="stylesheet" href="node_modules/smalltalk/dist/smalltalk.min.css">

  </head>

  <body background="image/background.jpg">

    
    <div class="container">

    
    	<table cellpadding="10" align="center"> 
        	<tr>
        		<td colspan="2">

             		<h1 style="text-align:center">
       				 	UDSSC CAV Server
					       </h1>

        	</tr>

        <tr id="start_button">
        		<td  style="cursor:pointer" id = "Start" align="center" class="start" rowspan="2">
        				
        						START
        		</td>
  
			  </tr>

			<tr id = "merge_botton">

			</tr>
        </table>

        

        <p>&nbsp;</p>

        
        <div class="row flat">
            
            <div class="col-lg-3 col-md-3 col-xs-6">
                <ul class="plan robot1">
                  
                  <li class="plan-name">
                    <table align = "center" width = "100%">
                        <td>
                            Robot 01
                        </td>
                        <td>
                   		
                              <img align="right" id = "battery_icon01" src= "image/battery84.png" style="max-width:27px;" /> 
                        </td>
                        <td>
                               <font align="right" id = "battery_lev01" size="2" color="black" style="font-weight:bold;font-style:italic;">100%</font> 
                        </td>
                      </table>
                    </li>
                    	

                    	
                    	             
                    </li>
                    <div id = "conntag01" class="Disconnect">
                        Disconnect  
                        </div> 
                    <script type="text/javascript" src = connected.js>
                    </script>            
                </ul>
            </div>
        
       		 <div  id = "parent" class="col-lg-3 col-md-3 col-xs-6">
        		<ul  class="plan robot1">
        			<li class="add">
        				<img id = "minus_icon" src= "image/minus.png" style="max-width:65px;" /> 
        				<img id = "add_icon" src= "image/add.png" style="max-width:65px;" />
        				<img id = "more" src= "image/more.png" style="max-width:30px;" /> 
        			</li>
        		</ul>
        	</div>

        	
        	<script type="text/javascript">
        		
        		const { spawn }= require('child_process');
        		const smalltalk = require('smalltalk')
        		
        		
        		var int_num = 1;
        		var num = "01"
        		
        		function plus(){
        			int_num = int_num+1;
  					if(int_num<10){
  						num = "0"+int_num.toString();
  					}else{
  						num = int_num.toString();
  					}
  					  var main_ = document.createElement('div');
              var ul_ = document.createElement('ul');
              var li_name = document.createElement('li');
              var table_ = document.createElement('table');
              var table_1 = document.createElement('td');
              var table_2 = document.createElement('td');
              var table_3 = document.createElement('td');
              var img_batt = document.createElement('img');
              var batt_percent = document.createElement('font');
              var div_conn = document.createElement('div');

              main_.className = "col-lg-3 col-md-3 col-xs-6";
              main_.id = "main_"+num;
              ul_.className = "plan robot1";
            
              li_name.className = "plan-name";
              table_.align = "center";
              table_.width = "100%";
              table_1.innerHTML = "Robot "+num;
              
            
              img_batt.align = "right";
              img_batt.id = "battery_icon"+num;
              img_batt.src = "image/battery84.png";
              img_batt.style.width = "27px";

              batt_percent.id = "battery_lev" + num;
              batt_percent.size = "2";
              batt_percent.color = "black";
              batt_percent.style="font-weight:bold;font-style:italic;";
              batt_percent.innerHTML = "100%";

              div_conn.className = "Disconnect";
              div_conn.id = "conntag"+num;
              div_conn.innerHTML = "Disconnect";
            
            table_2.appendChild(img_batt);
            table_3.appendChild(batt_percent);
            table_.appendChild(table_1);
            table_.appendChild(table_2);
            table_.appendChild(table_3);
            
            li_name.appendChild(table_);
            
            ul_.appendChild(li_name);
            ul_.appendChild(div_conn);
            main_.appendChild(ul_);

            var parent_node = document.getElementById("parent");
            parent_node.parentNode.insertBefore(main_ , parent_node);
            }
				
				function substract(){
					var child=document.getElementById("main_"+num);
					child.parentNode.removeChild(child);
					int_num = int_num - 1;
					
					if(int_num<10){
  						num = "0"+int_num.toString();
  					}else{
  						num = int_num.toString();
  					}
			
				}
				document.getElementById("add_icon").onclick=function(){
						plus();
				}
				document.getElementById("minus_icon").onclick=function(){
						substract();
				}
				document.getElementById("more").onclick=function(){
					var temp = 0;
					smalltalk
					    .prompt('input need', 'How many nodes do you want?', '')
					    .then((value) => {
								if (int_num < value){
									temp = value-int_num;
									for(i = 0; i < temp; i++){
										plus();
									}
								}else{
									temp = int_num - value;
									for(i = 0; i < temp; i++){
										substract();
									}
									
								}	
							
					    })
				}
				for(i = 0; i < 34; i++){
                    plus();
                  }
        //------------------------one click start------------------------
		var onceonly = 0;
        var onceonly_inter = 0;
        var onceonly_merge = 0;
        var onceonly_run = 0;
        function add_merge_inter(){
              var inter_ = document.createElement('td');
              var merge_ = document.createElement('td');
              inter_.align = "center";
              merge_.align = "center";
              inter_.style = "cursor:pointer";
              merge_.style = "cursor:pointer";
              inter_.className = "inter";
              merge_.className = "Merge";
              inter_.innerHTML = "Inter";
              merge_.innerHTML = "Merge";
              inter_.id = "inter_ID";
              merge_.id = "merge_ID";
            
              var p_node1 = document.getElementById("start_button");
              var P_node2 = document.getElementById("merge_botton");
              p_node1.appendChild(inter_);
              P_node2.appendChild(merge_);
              
        }
        function start_control0(){
          rosvicon = spawn("bash",["rosvicon.sh"]);
          rosvicon.on("close", function(){
                  console.log("has been ended");
            })
        }
        function start_control1(){
          
            startcorners = spawn("bash",["startcorners.sh"],{stdio: 'inherit' });

            startcorners.on("close", function(){
                  console.log("has been ended");
            })

          }
        function start_control2(){
        	  startvectorfield = spawn("bash",["startvectorfield.sh"],{stdio: 'inherit' });

            startvectorfield.on("close", function(){
                  console.log("has been ended");
            })

        }
        function start_control3(){
          runmergecontrol = spawn("bash",["runmergecontrol.sh"],{stdio: 'inherit' });
          runmergecontrol.on("close", function(){
                  console.log("has been ended");
            })
    

        }
        function start_merge(){
        		  run();
                setTimeout(function(){
                  runmergesim = spawn("bash",["runmergesim.sh"],{stdio: 'inherit' });
                  runmergesim.on("close", function(){
                  console.log("has been ended");
                  })
                },2000);
        }
        function start_inter(){
        		  run();
               setTimeout(function(){
                  runintersim = spawn("bash",["runintersim.sh"],{stdio: 'inherit' });
                  runintersim.on("close", function(){
                  console.log("has been ended");
                })
               },2000);
        }
        function run(){
        		  runcity = spawn("bash",["runcity.sh"],{stdio: 'inherit' });
                  runcity.on("close", function(){
                  console.log("has been ended");
                })
        }
        function kill_all_inter(){
                    rosvicon.kill();
                    startcorners.kill();
                    startvectorfield.kill();
                    runmergecontrol.kill();
                    runintersim.kill();
                    runcity.kill();
                    spawn("sh",["killprocess.sh"],{stdio: 'inherit' });

        }
        function kill_all_merge(){
            rosvicon.kill();
            startcorners.kill();
            startvectorfield.kill();
            runmergecontrol.kill();
            runmergesim.kill();
            runcity.kill();
            spawn("sh",["killprocess.sh"],{stdio: 'inherit' });
		}
        function add_reset(){
               
                var child=document.getElementById("inter_ID");
                child.parentNode.removeChild(child);
                var child=document.getElementById("merge_ID");
                child.parentNode.removeChild(child);
                var reset_ = document.createElement('td');
                 
                 reset_.align = "center";
                 reset_.style = "cursor:pointer";
                 reset_.className = "reset";
                 reset_.innerHTML = "RESET";
                 reset_.id = "reset_ID";
                 var P_node = document.getElementById("start_button");
                 P_node.appendChild(reset_);
                  
                 var child=document.getElementById("Start");
                 child.parentNode.removeChild(child);
                 
        }
        function add_start(){
             var start_ = document.createElement('td');
         
              start_.align = "center";
              start_.style = "cursor:pointer";
              start_.className = "start";
              start_.innerHTML = "START";
              start_.id = "Start";
              start_.rowSpan = "2";
              var p_node1 = document.getElementById("start_button");
              p_node1.appendChild(start_);
        }


       function reset_onclick(){
         document.getElementById("reset_ID").onclick = function(){
              var child=document.getElementById("reset_ID");
              child.parentNode.removeChild(child);
              if(onceonly_inter == 1){
              	kill_all_inter();
              }else{
              	kill_all_merge();
              }

              
              add_start();
              onceonly = 0;
              onceonly_inter = 0;
              onceonly_merge = 0;
              start_click();
            
          }
        }

      function start_click(){
        document.getElementById("Start").onclick=function(){
            if (onceonly == 0){
            document.getElementById("Start").innerHTML= "Please wait for 5 seconds..."
            start_control0();
            setTimeout(function(){
            start_control1();
            setTimeout(function(){
            

                start_control2();
                
                setTimeout(function(){
                    document.getElementById("Start").innerHTML= "Start";
                    console.log("please wait 5 seconds")
                    start_control3();
                    add_merge_inter();
                
                    onceonly = 1;
                
                    document.getElementById("inter_ID").onclick = function(){
                        start_inter();
                        if (onceonly_inter == 0){
                        add_reset();
                        reset_onclick();
                        onceonly_inter = 1;
                        }
                      }
                    document.getElementById("merge_ID").onclick = function(){
                        start_merge();
                        if (onceonly_merge == 0){
                          add_reset();
                          reset_onclick();
                          onceonly_merge = 1;
                         }
                    }
                  },2000);
             
			         },5000);
            },2000);
            }
          }
        }  
         start_click();

                   
              
			
			</script>

    	</div>

<div id="footer">
  <div class="container">
    <p class="text-muted credit">More imformation <a href="http://sites.udel.edu/ids-lab/" target="_blank" title="模板之家">connected vehicles.</a>
</div>
</div>
</body>
</html>
